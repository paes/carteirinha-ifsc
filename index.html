<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Carteira de Saída Antecipada - IFSC Garopaba</title>

  <meta name="theme-color" content="#7aba05" />

  <!-- Manifest do PWA -->
  <link rel="manifest" href="manifest.webmanifest" />

  <!-- Favicons (todos em icons/) -->
  <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png" />
  <link rel="icon" href="icons/favicon.ico" />

  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <main id="app">

    <!-- TELA INICIAL (LOGIN / HOME) -->
    <section id="login-screen" class="screen screen-login">
      <div class="brand-login">
        <img
          src="icons/logo-v.png"
          alt="Instituto Federal de Santa Catarina - Câmpus Garopaba"
          class="logo-vertical"
        />
      </div>

      <h1>Carteira de Saída Antecipada</h1>

      <!-- Área de login com Google -->
      <div id="login-area">
        <p class="subtitle">
          Faça login com sua conta institucional para acessar sua carteirinha.
        </p>

        <button id="google-login-btn" type="button" class="google-btn">
          <img src="icons/google-logo.webp" alt="" class="google-icon" />
          <span>Entrar com Google</span>
        </button>

        <p class="subtitle" style="margin-top: 0.75rem; font-size: 0.85rem;">
          Apenas contas <strong>@aluno.ifsc.edu.br</strong> e <strong>@ifsc.edu.br</strong> são aceitas.
        </p>
      </div>

      <!-- Área exibida após login -->
      <div id="home-area" class="hidden">
        <h2>Olá, <span id="user-name"></span></h2>
        <p class="subtitle">
          Logado como <span id="user-email"></span>
        </p>

        <!-- Banner quando admin estiver "vendo como aluno" -->
        <p id="admin-student-banner" class="small-note admin-student-banner hidden">
          <!-- preenchido via JS -->
        </p>

        <div class="home-actions">
          <!-- Botões do aluno -->
          <button id="home-card-btn" type="button" class="primary" disabled>
            Ver minha carteira
          </button>
          <p id="home-card-msg" class="small-note"></p>

          <button id="home-request-btn" type="button">
            Solicitar / atualizar carteira
          </button>

          <!-- Botões específicos para admins -->
          <button
            id="home-admin-btn"
            type="button"
            class="primary hidden"
          >
            Ir para painel administrativo
          </button>


          <button
            id="home-view-as-student-btn"
            type="button"
            class="secondary hidden"
          >
            Ver como aluno (teste)
          </button>

          <button
            id="home-back-admin-role-btn"
            type="button"
            class="secondary hidden"
          >
            Voltar ao papel de servidor
          </button>

          <button id="home-logout-btn" type="button" class="link-button">
            Sair da conta
          </button>

          <!-- Versão do app (preenchida via JS) -->
          <p id="app-version" class="app-version"></p>
        </div>
      </div>
    </section>

    <!-- TELA DE SOLICITAÇÃO DE CARTEIRA (ESTUDANTE) -->
    <section id="request-screen" class="screen hidden">
      <header class="top-bar">
        <h2>Solicitar Carteira de Saída Antecipada</h2>
        <button id="back-to-login" class="link-button" type="button">
          Voltar
        </button>
      </header>

      <form id="request-form">
        <label>
          Matrícula
          <input
            type="text"
            id="req-ra"
            required
            inputmode="numeric"
          />
        </label>

        <label>
          Nome completo do aluno
          <input type="text" id="req-nome" required />
        </label>

        <label>
          Curso
          <select id="req-curso" required>
            <option value="">Selecione...</option>
            <option value="Curso Técnico Integrado em Administração">
              Curso Técnico Integrado em Administração
            </option>
            <option value="Curso Técnico Integrado em Informática">
              Curso Técnico Integrado em Informática
            </option>
            <option value="Curso Técnico Integrado em Lazer">
              Curso Técnico Integrado em Lazer
            </option>
            <option value="Curso Técnico Concomitante em Biotecnologia">
              Curso Técnico Concomitante em Biotecnologia
            </option>
          </select>
        </label>

        <label>
          Turma
          <select id="req-turma" required>
            <option value="">Selecione...</option>
            <!-- Informática -->
            <option value="INF23">INF23</option>
            <option value="INF24">INF24</option>
            <option value="INF25">INF25</option>
            <option value="INF26">INF26</option>
            <!-- Lazer -->
            <option value="LAZ25">LAZ25</option>
            <option value="LAZ26">LAZ26</option>
            <!-- Administração -->
            <option value="ADM23">ADM23</option>
            <option value="ADM24">ADM24</option>
            <option value="ADM25">ADM25</option>
            <option value="ADM26">ADM26</option>
            <!-- Biotecnologia (Concomitante) -->
            <option value="BIT23">BIT23</option>
            <option value="BIT24">BIT24</option>
            <option value="BIT25">BIT25</option>
            <option value="BIT26">BIT26</option>
          </select>
        </label>

        <label>
          Data de nascimento do aluno
          <input type="date" id="req-data-nasc" required />
        </label>

        <label>
          Nome do responsável
          <input type="text" id="req-resp-nome" required />
        </label>

        <label>
          Telefone do responsável
          <input
            type="tel"
            id="req-resp-tel"
            required
            placeholder="48999999999"
            inputmode="tel"
          />
        </label>

        <label>
          Foto 3x4 (máx. 300 KB, formato imagem)
          <input type="file" id="req-foto" accept="image/*" />
        </label>

        <!-- BLOCO DE INFORMAÇÕES SOBRE AUTORIZAÇÃO DE SAÍDA ANTECIPADA -->
        <div class="info-box">
          <h3>Autorização de saída antecipada</h3>
          <p>
            A autorização de saída antecipada permite que estudantes menores
            saiam do câmpus em situações específicas, com acordo prévio entre
            família e estudante.
          </p>
          <p>Ela é válida apenas para:</p>
          <ul>
            <li>Trabalhos acadêmicos fora de horário de aula;</li>
            <li>Troca de horário de aulas;</li>
            <li>Ausência eventual de professores(as);</li>
            <li>Atendimentos extraclasse ou monitoria;</li>
            <li>Finalização antecipada de avaliações.</li>
          </ul>
          <p>
            Para outras situações, continua valendo o contato com a
            Coordenadoria Pedagógica.
          </p>
          <p>
            <strong>Links úteis:</strong><br />
            Modelo de autorização em PDF:
            <a
              href="https://drive.google.com/file/d/1quMZtj1anlwpyKQMkZf6BSiIJJZBwkDA/view"
              target="_blank"
              rel="noopener noreferrer"
            >
              abrir modelo
            </a><br />
            Assinador gov.br:
            <a
              href="https://assinador.iti.br/"
              target="_blank"
              rel="noopener noreferrer"
            >
              acessar assinador
            </a><br />
            Formulário institucional completo:
            <a
              href="https://docs.google.com/forms/d/e/1FAIpQLSdc7TBD05qC_7_iKxxi9TDlT6W5kWzR3qtEQNR-lCkMWXa1lQ/viewform"
              target="_blank"
              rel="noopener noreferrer"
            >
              abrir formulário
            </a>
          </p>
        </div>

        <label class="checkbox-line">
          <input type="checkbox" id="req-saida-autorizada" />
          Li as informações sobre a saída antecipada e declaro que o responsável
          já assinou (ou assinará) o termo no gov.br.
        </label>

        <label class="checkbox-line">
          <input type="checkbox" id="req-resp-ok" />
          Entreguei (ou entregarei) na coordenação a autorização assinada pelo
          responsável.
        </label>

        <button type="submit" class="primary">
          Enviar pedido de carteira de saída
        </button>
      </form>
    </section>

    <!-- TELA DA CARTEIRA DO ESTUDANTE -->
    <section id="card-screen" class="screen hidden">
      <div class="card-rotated-wrapper">

        <!-- Botão flutuante de VOLTAR -->
        <button id="logout-btn" class="logout-floating" type="button">
          Voltar
        </button>

        <div class="card">
          <div class="card-header">
            <div class="card-header-left">
              <img
                src="icons/logo-h.png"
                alt="Instituto Federal de Santa Catarina - Câmpus Garopaba"
                class="logo-horizontal"
              />
            </div>
            <div class="card-header-right">
              <span class="header-line-small">
                INSTITUTO FEDERAL DE EDUCAÇÃO, CIÊNCIA E TECNOLOGIA
              </span>
              <span class="header-line-medium">
                SANTA CATARINA – CÂMPUS GAROPABA
              </span>
              <span class="header-line-big">
                CARTEIRA DE AUTORIZAÇÃO DE SAÍDA ANTECIPADA
              </span>
            </div>
          </div>

          <div class="card-main">
            <div class="card-photo">
              <div class="photo-placeholder" id="card-photo-placeholder">
                FOTO
              </div>
              <div id="card-stamp" class="card-stamp">
                <!-- SAÍDA AUTORIZADA / PENDENTE -->
              </div>
            </div>

            <div class="card-fields">
              <!-- NOME em linha cheia -->
              <div class="card-field full">
                <span class="field-label">NOME</span>
                <span class="field-value" id="card-name"></span>
              </div>

              <!-- MATRÍCULA + IDADE na mesma linha -->
              <div class="card-row">
                <div class="card-field half">
                  <span class="field-label">MATRÍCULA</span>
                  <span class="field-value" id="card-ra"></span>
                </div>
                <div class="card-field half">
                  <span class="field-label">IDADE DO ALUNO</span>
                  <span class="field-value" id="card-idade"></span>
                </div>
              </div>

              <!-- CURSO / TURMA em linha cheia -->
              <div class="card-field full">
                <span class="field-label">CURSO / TURMA</span>
                <div class="field-value field-value-curso-turma">
                  <span id="card-course"></span>
                  <span id="card-turma" class="tag-turma"></span>
                </div>
              </div>

              <!-- RESPONSÁVEL + TELEFONE na mesma linha -->
              <div class="card-row">
                <div class="card-field half">
                  <span class="field-label">NOME DO RESPONSÁVEL</span>
                  <span class="field-value" id="card-resp-nome"></span>
                </div>
                <div class="card-field half">
                  <span class="field-label">TELEFONE DO RESPONSÁVEL</span>
                  <span class="field-value" id="card-resp-tel"></span>
                </div>
              </div>

              <!-- SITUAÇÃO -->
              <div class="card-field full status-field">
                <span class="field-label">SITUAÇÃO / SAÍDA ANTECIPADA</span>
                <span class="field-value" id="card-status-msg"></span>
              </div>

              <!-- Observações -->
              <div class="card-footer">
                <span class="footer-title">Observações</span>
                <span class="footer-text">
                  Válida exclusivamente para saída antecipada nas seguintes situações:
                  trabalhos acadêmicos fora de horário de aula; troca de horário de
                  aulas; ausência eventual de professores(as); atendimentos
                  extraclasse ou monitoria; finalização antecipada de avaliações.
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- TELA DO ADMINISTRADOR -->
    <section id="admin-screen" class="screen hidden">
      <header class="top-bar">
        <h2>Painel administrativo</h2>
        <button id="admin-logout-btn" class="link-button" type="button">
          Voltar
        </button>
      </header>

      <!-- Abas -->
      <div class="admin-tabs">
        <button
          id="admin-tab-pendentes"
          type="button"
          class="admin-tab-button active"
        >
          Pedidos pendentes
        </button>
        <button
          id="admin-tab-ativos"
          type="button"
          class="admin-tab-button"
        >
          Carteiras ativas
        </button>
        <button
          id="admin-tab-rejeitados"
          type="button"
          class="admin-tab-button"
        >
          Pedidos rejeitados
        </button>
        <button
          id="admin-tab-roles"
          type="button"
          class="admin-tab-button hidden"
        >
          Administradores
        </button>
      </div>

      <!-- Área: Pedidos pendentes -->
      <div id="admin-pendentes-area" class="admin-section">
        <p class="subtitle">
          Abaixo estão os pedidos de carteira de saída pendentes de aprovação.
        </p>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Nome</th>
                <th>Matrícula</th>
                <th>Curso</th>
                <th>Turma</th>
                <th>Formulário</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody id="admin-table-body">
              <!-- preenchido via JS -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Área: Carteiras ativas -->
      <div id="admin-ativos-area" class="admin-section hidden">
        <p class="subtitle">
          Busque e filtre as carteiras ativas.
        </p>

        <div class="admin-filters">
          <input
            type="text"
            id="admin-search"
            placeholder="Buscar por nome ou matrícula"
          />

          <select id="admin-filter-curso">
            <option value="">Todos os cursos</option>
            <option value="Curso Técnico Integrado em Administração">
              Curso Técnico Integrado em Administração
            </option>
            <option value="Curso Técnico Integrado em Informática">
              Curso Técnico Integrado em Informática
            </option>
            <option value="Curso Técnico Integrado em Lazer">
              Curso Técnico Integrado em Lazer
            </option>
            <option value="Curso Técnico Concomitante em Biotecnologia">
              Curso Técnico Concomitante em Biotecnologia
            </option>
          </select>

          <select id="admin-filter-turma">
            <option value="">Todas as turmas</option>
            <!-- Mesmo conjunto de turmas do formulário -->
            <option value="INF23">INF23</option>
            <option value="INF24">INF24</option>
            <option value="INF25">INF25</option>
            <option value="INF26">INF26</option>
            <option value="LAZ25">LAZ25</option>
            <option value="LAZ26">LAZ26</option>
            <option value="ADM23">ADM23</option>
            <option value="ADM24">ADM24</option>
            <option value="ADM25">ADM25</option>
            <option value="ADM26">ADM26</option>
            <option value="BIT23">BIT23</option>
            <option value="BIT24">BIT24</option>
            <option value="BIT25">BIT25</option>
            <option value="BIT26">BIT26</option>
          </select>
        </div>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Nome</th>
                <th>Matrícula</th>
                <th>Curso</th>
                <th>Turma</th>
                <th>Responsável</th>
                <th>Telefone</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody id="admin-ativos-body">
              <!-- preenchido via JS -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Área: Pedidos rejeitados -->
      <div id="admin-rejeitados-area" class="admin-section hidden">
        <p class="subtitle">
          Pedidos que foram rejeitados ou carteiras desativadas. Use com cuidado a reaprovação.
        </p>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Nome</th>
                <th>Matrícula</th>
                <th>Curso</th>
                <th>Turma</th>
                <th>Responsável</th>
                <th>Telefone</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody id="admin-rejeitados-body">
              <!-- preenchido via JS -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Área: Administração de administradores (somente admins) -->
      <div id="admin-roles-area" class="admin-section hidden">
        <p class="subtitle">
          Gerencie quais servidores <strong>@ifsc.edu.br</strong> têm acesso ao painel administrativo.
        </p>

        <form id="admin-roles-form">
          <label>
            Login do servidor (sem @ifsc.edu.br)
            <input
              type="text"
              id="admin-role-login"
              placeholder="ex: jacqueline.bastos"
            />
          </label>
          <button type="submit" class="primary">
            Adicionar administrador
          </button>
          <p class="small-note">
            Será salvo como <code>login@ifsc.edu.br</code>. Apenas administradores conseguem alterar esta lista.
          </p>
        </form>

        <div class="table-wrapper" style="margin-top: 1rem;">
          <table>
            <thead>
              <tr>
                <th>Email institucional</th>
                <th>Papel</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody id="admin-roles-body">
              <!-- preenchido via JS -->
            </tbody>
          </table>
        </div>
      </div>
    </section>

  </main>

  <!-- Firebase (SDK compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBCPZfzhJFe9Z9xvCFPQzzNzKZI2E1zBZc",
      authDomain: "ifsc-carteirinha.firebaseapp.com",
      projectId: "ifsc-carteirinha",
      storageBucket: "ifsc-carteirinha.firebasestorage.app",
      messagingSenderId: "318167433982",
      appId: "1:318167433982:web:7e5dd8e6c47a92d30e9baf"
    };

    firebase.initializeApp(firebaseConfig);

    // Firestore e Auth globais para app.js
    const firestore = firebase.firestore();
    const auth = firebase.auth();

    // (opcional) modo offline do Firestore
    firebase.firestore().enablePersistence().catch((err) => {
      console.warn("Persistência offline não habilitada:", err.code);
    });
  </script>

  <!-- Seu app -->
  <script src="app.js"></script>
</body>
</html>
